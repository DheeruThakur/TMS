Vagrant.configure("2") do |config|
  config.vm.define "web" do |fedora|
      fedora.vm.box = "jacobw/fedora35-arm64" 
      fedora.vm.hostname="web"
      fedora.vm.network "private_network", ip: "192.168.56.12"
      fedora.vm.provider "vmware_desktop" do |vmware|
        vmware.memory = "1600"
      end
      fedora.vm.provision "shell", inline: <<-SHELL
        #!/bin/bash
        echo "⚡️ Welcome to the TMS web server setup process! ⚡️"
        echo "⚡️ Scanning for available package upgrades..."
        yum update > /dev/null
        echo "✅ Scan completed successfully!"
        # echo "⚡️⚡️ Upgrading packages to the latest versions..."
        # apt upgrade > /dev/null
        # echo "✅ Upgrade completed successfully!"
        echo "⚡️⚡️ Installing essential project tools like Node.js, Git, NPM..."
        dnf module install nodejs:18 -y
        yum install git -y
        echo "✅ Project tools installed successfully!"
        echo "⚡️⚡️ Fetching the latest code from the cloud..."
        git clone https://github.com/POOL4T7/TMS.git
        cd TMS/client
        echo "⚡️⚡️ Installing server dependencies..."
        npm install
        echo "✅ Server dependencies installed successfully!"
        npm run build
        echo "⚡️ Your project is now ready to roll! ⚡️"
  SHELL
  end

  config.vm.define "server" do |ubuntu|
      ubuntu.vm.box = "spox/ubuntu-arm" 
      ubuntu.vm.hostname = "server" 
      ubuntu.vm.box_version = "1.0.0"
      ubuntu.vm.network "private_network", ip: "192.168.56.11"
      ubuntu.vm.network "public_network"
      ubuntu.vm.provider "vmware_desktop" do |vmware|
          vmware.cpus="2"
          vmware.memory = "1600"
        end
      ubuntu.vm.provision "shell", inline: <<-SHELL
        echo "⚡️ Welcome to the TMS server setup process! ⚡️"
        echo "⚡️ Scanning for available package upgrades..."
        apt update > /dev/null
        echo "✅ Scan completed successfully!"
        # echo "⚡️⚡️ Upgrading packages to the latest versions..."
        # apt upgrade > /dev/null
        # echo "✅ Upgrade completed successfully!"
        echo "⚡️⚡️ Installing essential project tools like Node.js and NPM..."
        sudo snap install node --channel=16/stable --classic
        echo "✅ Project tools installed successfully!"
        echo "⚡️⚡️ Fetching the latest code from the cloud..."
        git clone https://github.com/POOL4T7/TMS.git
        cd TMS/server
        echo "⚡️⚡️ Installing server dependencies..."
        npm install
        echo "✅ Server dependencies installed successfully!"
        # cat <<EOT > .env
        #   PORT=8080
        #   NODE_ENV=development
        #   MONGO_URI=mongodb://gulshan:1alyxstar@localhost:27017/social?authSource=admin
        # EOT
        # echo "✅ Enviroment added successfully."
        npm run build
        echo "⚡️ Your project is now ready to roll! ⚡️"
    SHELL
  end
end
